#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
OPR ìë™ ë¬¸ì œì§€ ìƒì„± ì‹œìŠ¤í…œ
- PDF íŒŒì¼ì—ì„œ ë¬¸ì œ ìš”ì†Œ ì¶”ì¶œ
- ìƒˆë¡œìš´ ë¬¸ì œ ìë™ ìƒì„±
"""

import os
import re
import random
from typing import List, Dict
from dataclasses import dataclass
import json


@dataclass
class ExamSection:
    """ë¬¸ì œ ì„¹ì…˜"""
    title: str
    content: str
    section_type: str  # CEOë©”ì‹œì§€, ì´ë©”ì¼, ë©”ì‹ ì €, ë³´ê³ ì„œ, ê¸°ì‚¬ ë“±


@dataclass
class ExamTemplate:
    """ë¬¸ì œ í…œí”Œë¦¿"""
    year: str
    session: str  # 1êµì‹œ, 2êµì‹œ
    title: str
    situation: str
    task_description: str
    sections: List[ExamSection]
    keywords: List[str]


class ExamGenerator:
    """ë¬¸ì œì§€ ìƒì„±ê¸°"""

    def __init__(self, pdf_dir: str = "./"):
        self.pdf_dir = pdf_dir
        self.templates = []
        self.ceo_messages = []
        self.email_templates = []
        self.report_templates = []

    def load_exam_patterns(self):
        """ê¸°ì¶œë¬¸ì œ íŒ¨í„´ í•™ìŠµ"""

        # 2025ë…„ 1êµì‹œ ë¬¸ì œ íŒ¨í„´ (ì œê³µëœ ìë£Œ ê¸°ë°˜)
        template_2025_1 = {
            "ìƒí™©": "Aê¸°ì—… ì „ë ¥ê³„í†µë³¸ë¶€ ê³„í†µì •ì±…ì²˜ ê³„í†µì •ì±…ë¶€ 'ë°• ì°¨ì¥'",
            "ê³¼ì œ": "ì „ë ¥ë§ ê±´ì„¤ ì§€ì—°ì— ëŒ€í•œ ëŒ€ì‘ì „ëµ ìˆ˜ë¦½",
            "ë³´ê³ ì„œ_êµ¬ì„±": ["ì¶”ì§„ë°°ê²½", "ì¶”ì§„ë°©í–¥", "ëŒ€ì‘ì „ëµ", "í–¥í›„ê³„íš"],
            "ì œì‹œìë£Œ_ìœ í˜•": [
                "CEO ì†Œí†µ ë©”ì‹œì§€",
                "ì²˜ì¥ ì´ë©”ì¼",
                "ë¶€ì¥ ë©”ì‹ ì €(KepTalk)",
                "ì‚¬ë‚´ë©”ì‹ ì € ìª½ì§€",
                "ì‚°ì—…ë¶€ ë³´ê³ ì„œ",
                "Aê¸°ì—… T/F ë³´ê³ ì„œ",
                "ì—…ë¬´ë³´ê³  ì„¤ëª…ìë£Œ",
                "ìš©ì—­ ê²°ê³¼ìë£Œ",
                "ì‹ ë¬¸ ê¸°ì‚¬",
                "ì–¸ë¡ ë³´ë„ ìë£Œ",
                "ê²½ì˜ì „ëµì—°êµ¬ì› ë³´ê³ ì„œ",
                "ë‚´ë¶€ë¬¸ì„œ",
                "í•™íšŒ ë°œí‘œìë£Œ"
            ]
        }

        self.exam_patterns = [template_2025_1]

        # CEO ë©”ì‹œì§€ í…œí”Œë¦¿
        self.ceo_message_templates = [
            {
                "êµ¬ì¡°": "ì¸ì‚¬ â†’ ì„±ê³¼ ì¹­ì°¬ â†’ í˜„ì•ˆ ì„¤ëª… â†’ ëŒ€ì‘ í•„ìš”ì„± ê°•ì¡° â†’ í–¥í›„ ì¼ì • ì•ˆë‚´",
                "í‚¤ì›Œë“œ_ìœ„ì¹˜": ["í˜„ì•ˆ ì„¤ëª…", "í–¥í›„ ì¼ì •"],
                "í†¤": "ê²©ë ¤ì™€ ë…ë ¤"
            }
        ]

        # ì´ë©”ì¼ í…œí”Œë¦¿
        self.email_templates = [
            {
                "êµ¬ì¡°": "ë°œì‹ /ìˆ˜ì‹ /ì°¸ì¡°/ì¼ì‹œ/ì œëª© â†’ ìƒí™© ì„¤ëª… â†’ ì§€ì‹œì‚¬í•­ â†’ ì¼ì • ì•ˆë‚´",
                "í‚¤ì›Œë“œ_ìœ„ì¹˜": ["ì§€ì‹œì‚¬í•­", "ì¼ì •"],
                "íŠ¹ì§•": "êµ¬ì²´ì ì¸ ë³´ê³  ìš”êµ¬ì‚¬í•­ ëª…ì‹œ"
            }
        ]

    def generate_ceo_message(
        self,
        main_issue: str,
        keywords: List[str],
        schedule: Dict[str, str]
    ) -> str:
        """CEO ë©”ì‹œì§€ ìƒì„±"""

        message = f"""ì œì‹œìë£Œ 1 : Aê¸°ì—… CEO ì†Œí†µ ë©”ì‹œì§€

ë³´ë‚¸ì‚¬ëŒ ê¹€â—‹â—‹<ceo@company.co.kr>
ë³´ë‚¸ì¼ì‹œ 2024. 12. 5 09:10
ì œ    ëª© [CEO ì†Œí†µ ë©”ì‹œì§€] ì‚¬ë‘í•˜ëŠ” Aê¸°ì—… ê°€ì¡± ì—¬ëŸ¬ë¶„

Aê¸°ì—… ê°€ì¡± ì—¬ëŸ¬ë¶„,

ì§€ë‚œ ì£¼ ìš°ë¦¬íšŒì‚¬ëŠ” ëŒ€í•œë¯¼êµ­ ìš°ìˆ˜ê²½ì˜ ëŒ€íšŒì—ì„œ ì¢…í•©ëŒ€ìƒì„ ìˆ˜ìƒí–ˆìŠµë‹ˆë‹¤.
ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ê¸°ê¹Œì§€ ê³ ìƒí•œ ì—¬ëŸ¬ë¶„ê»˜ ê¹Šì€ ê°ì‚¬ì˜ ë§ì”€ì„ ë“œë¦¬ë©°, ì € ì—­ì‹œë„
Aê¸°ì—… ê°€ì¡±ì˜ ì¼ì›ìœ¼ë¡œì„œ ìë¶€ì‹¬ì„ ëŠë‚ë‹ˆë‹¤.

- ì¤‘ëµ -

{main_issue}

ì§€ë‚œì£¼ì—ëŠ” {keywords[0]} ê´€ë ¨ ì „ì‚¬ í† ë¡ íšŒë¥¼ ê°œìµœí•˜ì˜€ê³ , {schedule['event_date']}ì—ëŠ”
{schedule['event_name']}ê°€ ì—´ë¦´ ì˜ˆì •ì…ë‹ˆë‹¤. {keywords[1]}ëŠ” ìš°ë¦¬ íšŒì‚¬ ì§ì› ëª¨ë‘ì˜
ì¼ì…ë‹ˆë‹¤. íšŒì‚¬ì˜ ìµœìš°ì„  ê³¼ì œì¸ {keywords[2]}ë¥¼ ìœ„í•´, ìš°ë¦¬ê°€ ê°ê³ ì˜ ë…¸ë ¥ì„ ë‹¤í•˜ê³ 
ìˆë‹¤ëŠ” ê²ƒì„ ì£¼ë³€ì— ë„ë¦¬ ì•Œë¦¬ëŠ” ì¼ì— ëª¨ë‘ í•˜ë‚˜ê°€ ë˜ì–´ì•¼ í•  ê²ƒì…ë‹ˆë‹¤.

ì´ë²ˆ ë‹¤ì§ëŒ€íšŒë¥¼ í†µí•´ ìš°ë¦¬ì˜ ì—­ëŸ‰ì„ í•œë° ëª¨ì•„ ì‚°ì—…ë¶€ì˜ ìš°ë ¤ë¥¼ ë¶ˆì‹ì‹œí‚¤ê³ 
êµ­ë¯¼ì„ ì„¤ë“í•˜ê² ìŠµë‹ˆë‹¤.

ì†Œì¤‘í•œ ë™ë£Œë“¤ê³¼ ì¦ê±°ìš´ í•œ ì£¼ ë³´ë‚´ì‹­ì‹œì˜¤.

ê¹€â—‹â—‹ ë“œë¦¼."""

        return message

    def generate_email(
        self,
        sender: str,
        receiver: str,
        subject: str,
        main_task: str,
        deadline: str,
        details: List[str]
    ) -> str:
        """ì´ë©”ì¼ ìƒì„±"""

        email = f"""ì œì‹œìë£Œ 2 : {sender} ë°œì†¡ ì´ë©”ì¼

ë³´ë‚¸ì‚¬ëŒ {sender} <sender@company.co.kr>
ë°›ëŠ”ì‚¬ëŒ {receiver} <receiver@company.co.kr>
ì°¸    ì¡° ê³„í†µì •ì±…ë¶€ ë°• ì°¨ì¥ <park@company.co.kr>
ë³´ë‚¸ì¼ì‹œ 2024. 12. 5 10:34
ì œ    ëª© [ê¸´ê¸‰] {subject}

ì´ ë¶€ì¥ë‹˜,

ì‚¬ì¥ë‹˜ì´ ì˜¤ëŠ˜ [CEO ì†Œí†µ ë©”ì‹œì§€]ì—ì„œ {main_task}ì„(ë¥¼) ì£¼ë¬¸í•˜ì…¨ìœ¼ë©°,
í•´ë‹¹ ë‚´ìš©ì€ ì‚°ì—…ë¶€ì™€ êµ­íšŒì˜ ìš”ì²­ìœ¼ë¡œ ì‚¬ì¥ë‹˜ê»˜ì„œ {deadline}ì— ì§ì ‘ ë³´ê³  ì˜ˆì •ì…ë‹ˆë‹¤.

ì´ì— ëŒ€í•œ ë³´ê³ ìë£ŒëŠ” ê³„í†µì •ì±…ì²˜ê°€ ì¤‘ì‹¬ì´ ë˜ì–´ ì‘ì„±í•˜ë¼ëŠ” ì‚¬ì¥ë‹˜ ì§€ì‹œê°€
ë‚´ë ¤ì™”ìŠµë‹ˆë‹¤. í•´ë‹¹ ë‚´ìš©ì„ 12ì›” 13ì¼ ì‚¬ì¥ë‹˜ê»˜ ë³´ê³ ë¥¼ ë“œë¦´ ìˆ˜ ìˆë„ë¡
ì‹ ê²½ ì¨ì„œ ì‘ì„± ë¶€íƒë“œë¦½ë‹ˆë‹¤.

"""

        for detail in details:
            email += f"{detail}\n\n"

        email += f"\n{sender} ë“œë¦¼"

        return email

    def generate_messenger_chat(
        self,
        participants: List[str],
        topic: str,
        guidance: List[Dict[str, str]]
    ) -> str:
        """ë©”ì‹ ì € ëŒ€í™” ìƒì„±"""

        chat = f"""ì œì‹œìë£Œ 3 : {participants[0]} KepTalk ì „ë‹¬ì‚¬í•­

{participants[0]}

{guidance[0]['message']}

ì˜¤ì „ 11:21

{participants[1]}

{guidance[1]['message']}

ì˜¤ì „ 11:22
"""

        return chat

    def generate_exam_from_template(
        self,
        title: str,
        situation: str,
        main_keywords: List[str],
        num_materials: int = 10
    ) -> str:
        """í…œí”Œë¦¿ ê¸°ë°˜ ë¬¸ì œì§€ ìƒì„±"""

        exam = f"""2025ë…„ 3ì§ê¸‰ ì¼ë°˜ìŠ¹ì§„ ì—­ëŸ‰í‰ê°€ ë¬¸ì œì§€
2024. 12. 7(í† )

ë¬¸ ì œ

1. ë³´ê³ ì„œ ì‘ì„±ë°°ê²½ ë° ìƒí™©

â–¡ {situation}

â–¡ ê·€í•˜ëŠ” 'Aê¸°ì—…' ì „ë ¥ê³„í†µë³¸ë¶€ ê³„í†µì •ì±…ì²˜ ê³„í†µì •ì±…ë¶€ 'ë°• ì°¨ì¥'ì´ë©°, ì‚°ì—…ë¶€ì™€
  êµ­íšŒë¡œë¶€í„° ì „ë ¥ë§ ë¬¸ì œ í•´ê²°ë°©ì•ˆì— ëŒ€í•œ ì—…ë¬´ë³´ê³ ë¥¼ ìš”êµ¬ë°›ì€ ìƒí™©ì´ë‹¤.
  ì´ì™€ ê´€ë ¨í•˜ì—¬ ê³„í†µì •ì±…ì²˜ì¥ìœ¼ë¡œë¶€í„° ì•„ë˜ì™€ ê°™ì´ ì—…ë¬´ì§€ì‹œë¥¼ ë°›ì•˜ìœ¼ë©°, ë³´ê³ ì„œë¥¼
  ì‘ì„±í•˜ì—¬ ì‚¬ì¥ì—ê²Œ ë³´ê³  ì˜ˆì •ì´ë‹¤. ì£¼ì–´ì§„ ì°¸ê³ /ê³ ë ¤ì‚¬í•­ê³¼ ì œì‹œìë£Œë¥¼
  í™œìš©í•˜ì—¬ ì‚¬ì¥ì—ê²Œ ë³´ê³ í•  {title} ë³´ê³ ì„œë¥¼ 1ì¥ìœ¼ë¡œ ì‘ì„±í•˜ì‹œì˜¤.

â—‹ (ì§€ì‹œì‚¬í•­) {main_keywords[0]} ê´€ë ¨ ëŒ€ì‘ì „ëµì„ ìˆ˜ë¦½í•˜ì—¬ ë³´ê³ í•  ê²ƒ

2. ë³´ê³ ì„œ ì‘ì„± ë° í‰ê°€ê¸°ì¤€

â–¡ ì œì‹œìë£Œë§Œì„ í† ëŒ€ë¡œ Aê¸°ì—…ì˜ '{title}'ì„ ìœ„í•´ 'ì¶”ì§„ë°°ê²½',
  'ì¶”ì§„ë°©í–¥'ì„ ì œì‹œí•˜ê³ , ë‹¨ê¸° ë° ì¤‘ì¥ê¸° 'ëŒ€ì‘ì „ëµ'ê³¼ 'í–¥í›„ê³„íš'ì„ ë³´ê³ í•  ê²ƒ

â–¡ ì‘ì„± ë° í‰ê°€ ì£¼ìš”ê¸°ì¤€
â—‹ ë…¼ë¦¬Â·ì •í™•ì„± : ë³´ê³ ì„œ ì „ì²´ì˜ ë…¼ë¦¬ê°€ ì¼ê´€ë˜ê³  êµ¬ì²´ì  ê·¼ê±°ì— ì˜ê±°í•˜ì—¬ ì‘ì„±
â—‹ ëª…í™•Â·ê°„ê²°ì„± : ë¶ˆí•„ìš”í•œ ì •ë³´ ì—†ì´ í•µì‹¬ë‚´ìš© ìœ„ì£¼ë¡œ ëª…í™•Â·ê°„ê²°í•˜ê²Œ ì‘ì„±
â—‹ ì™„ê²°ì„± : ë³´ê³  ëª©ì ì— ë¶€í•©í•˜ëŠ” êµ¬ì„±ìœ¼ë¡œ ì™„ê²°ëœ í˜•ì‹ì˜ ë³´ê³ ì„œë¥¼ ì‘ì„±

3. ì°¸ê³  ë° ê³ ë ¤ì‚¬í•­

â–¡ Aê¸°ì—… ì „ë ¥ê³„í†µë³¸ë¶€ ì¡°ì§ë„

[ì¡°ì§ë„ ìƒëµ]

4. ë°°ì  ë° ì‘ì„± ìœ ì˜ì‚¬í•­

â–¡ ë°° ì  (ì´ 100ì  ë§Œì , ìµœì¢… í™˜ì‚° ë°°ì  25ì )

í•­ ëª© | ë…¼ë¦¬Â·ì •í™•ì„± | ëª…í™•Â·ê°„ê²°ì„± | ì™„ê²°ì„± | í•© ê³„
ë°° ì  |     40     |     30     |   30   | 100ì 

â–¡ ì‘ì„± ìœ ì˜ì‚¬í•­ (ì•„ë˜ì˜ ê¸°ì¤€ê³¼ ë‹¤ë¥´ê²Œ ì‘ì„±ëœ ë‹µì•ˆì€ ê°ì ë  ìˆ˜ ìˆìŒ)
â—‹ ì´ 26ì¤„ ì´ë‚´ì˜ ê°œì¡°ì‹ìœ¼ë¡œ ì‘ì„±
â—‹ ê¸€ìì²´ ë° ê¸€ìí¬ê¸°
  - ì œ ëª© : HYí—¤ë“œë¼ì¸M, 21í¬ì¸íŠ¸, ìµœëŒ€ 21ì
  - ë³¸ ë¬¸ : ì‹ ëª…ì¡°, 13í¬ì¸íŠ¸, ìµœëŒ€ 35ì(ìˆœìˆ˜ ê¸€ììˆ˜)

"""

        # ì œì‹œìë£Œ ì¶”ê°€
        for i in range(1, num_materials + 1):
            exam += f"\nì œì‹œìë£Œ {i} : [ìë£Œ ë‚´ìš©]\n"

        return exam

    def create_practice_exam(
        self,
        difficulty: str = "medium"
    ) -> Dict:
        """ì—°ìŠµ ë¬¸ì œ ìƒì„±"""

        topics = [
            {
                "title": "ë””ì§€í„¸ ì „í™˜ ê°€ì†í™” ëŒ€ì‘ì „ëµ",
                "keywords": ["ë””ì§€í„¸ì „í™˜", "AIí™œìš©", "ë°ì´í„°ë¶„ì„", "ìë™í™”"],
                "situation": "4ì°¨ ì‚°ì—…í˜ëª… ì‹œëŒ€ ëŒ€ì‘ì„ ìœ„í•œ ë””ì§€í„¸ ì „í™˜ í•„ìš”ì„± ì¦ëŒ€"
            },
            {
                "title": "íƒ„ì†Œì¤‘ë¦½ ë‹¬ì„±ì„ ìœ„í•œ ì¶”ì§„ì „ëµ",
                "keywords": ["íƒ„ì†Œì¤‘ë¦½", "ì˜¨ì‹¤ê°€ìŠ¤ê°ì¶•", "ì¬ìƒì—ë„ˆì§€", "ESGê²½ì˜"],
                "situation": "2050 íƒ„ì†Œì¤‘ë¦½ ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ êµ¬ì²´ì  ì‹¤í–‰ë°©ì•ˆ ë§ˆë ¨ í•„ìš”"
            },
            {
                "title": "ì¸ì¬ ìœ¡ì„± ë° ì¡°ì§ë¬¸í™” í˜ì‹ ë°©ì•ˆ",
                "keywords": ["ì¸ì¬ìœ¡ì„±", "ì—­ëŸ‰ê°•í™”", "ì¡°ì§ë¬¸í™”", "ì„¸ëŒ€í†µí•©"],
                "situation": "ë³€í™”í•˜ëŠ” ì‹œëŒ€ì— ë§ëŠ” ì¸ì¬ìƒ ì •ë¦½ ë° ì¡°ì§ë¬¸í™” ê°œì„  í•„ìš”"
            }
        ]

        selected_topic = random.choice(topics)

        exam_data = {
            "title": selected_topic["title"],
            "situation": selected_topic["situation"],
            "keywords": selected_topic["keywords"],
            "difficulty": difficulty,
            "estimated_time": "150ë¶„",
            "materials_count": random.randint(10, 15)
        }

        return exam_data


def demo_exam_generation():
    """ë¬¸ì œ ìƒì„± ë°ëª¨"""

    generator = ExamGenerator()
    generator.load_exam_patterns()

    print("\n" + "="*60)
    print("ğŸ“„ OPR ìë™ ë¬¸ì œì§€ ìƒì„± ì‹œìŠ¤í…œ")
    print("="*60 + "\n")

    # CEO ë©”ì‹œì§€ ìƒì„±
    ceo_msg = generator.generate_ceo_message(
        main_issue="ë°˜ë„ì²´ ë“± ì²¨ë‹¨ì‚°ì—…ì˜ ì „ë ¥ìˆ˜ìš” ì¦ê°€, ì¬ìƒe ë°œì „ ì—°ê³„ ë¬¼ëŸ‰ ì¦ê°€ ë“± ì•ˆì •ì  ì „ë ¥ìˆ˜ê¸‰ì„ ìœ„í•œ ì „ë ¥ë§ì˜ ì—­í• ì´ ì¦ëŒ€ë˜ê³  ìˆìŠµë‹ˆë‹¤.",
        keywords=["ì „ë ¥ë§ í™•ì¶© ì—­ëŸ‰ê²°ì§‘", "ì „ë ¥ë§ ì ê¸° ê±´ì„¤", "ì•ˆì •ì  ì „ë ¥ê³µê¸‰"],
        schedule={
            "event_date": "12ì›” 16ì¼",
            "event_name": "ì „ë ¥ë§ ì ê¸° ê±´ì„¤ì„ ìœ„í•œ ì „ì‚¬ ë‹¤ì§ëŒ€íšŒ"
        }
    )
    print("=== CEO ë©”ì‹œì§€ ìƒì„± ì˜ˆì‹œ ===")
    print(ceo_msg[:500] + "...\n")

    # ì—°ìŠµ ë¬¸ì œ ìƒì„±
    practice_exam = generator.create_practice_exam()
    print("\n=== ì—°ìŠµ ë¬¸ì œ ìƒì„± ===")
    print(json.dumps(practice_exam, ensure_ascii=False, indent=2))

    # ì™„ì „í•œ ë¬¸ì œì§€ ìƒì„±
    full_exam = generator.generate_exam_from_template(
        title="ë””ì§€í„¸ ì „í™˜ ê°€ì†í™” ëŒ€ì‘ì „ëµ",
        situation="í•œêµ­ì˜ 'Aê¸°ì—…(ê°€ìƒì˜ íšŒì‚¬)'ì€ ì—ë„ˆì§€ ì‚°ì—…ì˜ ì „ ë¶€ë¬¸ ì‚¬ì—…ì„ ì˜ìœ„í•˜ê³  ìˆìœ¼ë©°, ìµœê·¼ ë””ì§€í„¸ ì „í™˜ ê°€ì†í™”ì— ëŒ€í•œ ëŒ€ì‘ì´ ì‹œê¸‰í•œ ìƒí™©ì´ë‹¤.",
        main_keywords=["ë””ì§€í„¸ ì „í™˜", "AI í™œìš©", "ì—…ë¬´ ìë™í™”"],
        num_materials=12
    )
    print("\n=== ì™„ì „í•œ ë¬¸ì œì§€ ìƒì„± (ì¼ë¶€) ===")
    print(full_exam[:800] + "...\n")


if __name__ == "__main__":
    demo_exam_generation()
